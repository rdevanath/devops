trigger:
- main

pool:
  name: test

# You can define variables in your pipeline YAML or in the pipeline UI:
# variables:
#   containerPort: 8080
#   hostPort: 9090
# - script: docker run -p $(hostPort):$(containerPort) myapp:$(Build.BuildNumber)

# Use environment variables directly in the script  - If you want to set them inline:
# - script: |
#     export HOST_PORT=9090
#     export CONTAINER_PORT=8080
#     docker run -p $HOST_PORT:$CONTAINER_PORT myapp:$(Build.BuildNumber)


# Pass variables from pipeline parameters - If you want ports to be configurable when triggering the pipeline:
parameters:
- name: hostPort
  type: string
# default: '8080'		# if removed - When you queue the pipeline, Azure DevOps will prompt you for hostPort and containerPort.
- name: containerPort
  type: string
# default: '8080' 		# if removed - When you queue the pipeline, Azure DevOps will prompt you for hostPort and containerPort.

steps:
- script: docker build . -t myapp:$(Build.BuildNumber)
  displayName: 'Build Docker image'
- script: docker run -d -p ${{ parameters.hostPort }}:${{ parameters.containerPort }} myapp:$(Build.BuildNumber)
  displayName: 'Run Docker container'


# Use $(variableName) for pipeline variables. Use variables if you want defaults but allow manual override at queue time.
# Use $VARIABLE_NAME for environment variables inside scripts. i.e. Inside the script, you reference them with ${{ parameters.name }}.
# Use parameters if you want a prompt every time the pipeline runs.